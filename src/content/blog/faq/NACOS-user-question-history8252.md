---
id: "question-history-8252"
title: "使用客户端SDK的删除实例API之后，为什么客户端查询实例依然可以查询到？但是使用管理端页面下线之后，使用客户端查询就查询不到了？客户端SDK删除实例和管理端页面下线的区别是什么？ nacos-opensource"
date: "2024-04-23"
category: expertConsultation
description: "nacos-opensource 使用客户端SDK的删除实例API之后，为什么客户端查询实例依然可以查询到？但是使用管理端页面下线之后，使用客户端查询就查询不到了？客户端SDK删除实例和管理端页面下线的区别是什么？"
tags: ["客户端SDK","删除实例API","查询实例","管理端页面","下线","客户端查询","区别"]
keywords: ["客户端SDK","删除实例API","查询实例","管理端页面","下线","客户端查询","区别"]
---

## 用户问题 ： 
 使用客户端SDK的删除实例API之后，为什么客户端查询实例依然可以查询到？但是使用管理端页面下线之后，使用客户端查询就查询不到了？客户端SDK删除实例和管理端页面下线的区别是什么？ nacos-opensource 

---------------
## 专家官方解答 ：

首先，依托我了解的知识分析问题的原因：

根据第1篇参考内容可知，Nacos的API分为openAPI和Admin API。其中，openAPI是供用户在服务发现过程中使用的API，与客户端SDK的API基本对应。而Admin API则服务于运维人员和控制台，用于进行更全面、深入的管理操作，如获取包括已下线实例在内的全部服务实例信息。具体而言，`CatalogController`属于Admin API的控制器，而`ServiceController`和`InstanceController`属于openAPI的控制器。

针对问题描述，客户端SDK使用删除实例API后，客户端查询依然能查到该实例，但通过管理端页面下线后，客户端查询就无法找到该实例。这表明两种操作在处理实例状态时存在差异：

1. **客户端SDK删除实例**：由于SDK调用的是openAPI，其删除操作可能仅针对服务发现逻辑，即从应用层面移除该实例，使其不再参与服务发现和负载均衡。这种情况下，虽然实例在服务发现的视角下被“删除”，但在Nacos服务器端的实际数据中，该实例可能并未被彻底删除或标记为下线，而是可能处于一种隐藏状态，不影响服务正常运行，但对openAPI查询不可见。

2. **管理端页面下线实例**：管理员通过Admin API（如`CatalogController`相关操作）下线实例时，会对实例进行明确的下线标记。这种标记不仅影响服务发现，还会更新服务器端实例的状态，使其在所有查询（包括openAPI和Admin API）中均表现为已下线。因此，客户端查询时自然无法找到已被明确下线的实例。

综上所述，客户端SDK使用删除实例API与管理端页面下线实例的主要区别在于对实例状态处理的深度和可见性。前者可能仅影响服务发现逻辑，后者则对实例进行全局标记，使之在所有查询中均显示为下线状态。

由于我了解的知识中并未给出针对此类问题的具体解决步骤，故此处不提供详细步骤。但基于上述分析，可以建议在排查类似问题时，关注以下几点：

- 确认客户端SDK删除实例API的具体实现和作用范围，是否仅影响服务发现，而不改变实例在Nacos服务器端的全局状态。
- 检查Nacos服务器端实例数据，确认在客户端SDK删除实例后，实例是否仍存在于数据库中，只是处于某种隐藏状态。
- 考虑是否需要调整客户端SDK的删除操作，使其调用具有明确下线实例功能的Admin API（如有权限），确保实例状态在服务器端得到正确更新。

总结来说，客户端SDK使用删除实例API后，客户端查询依然能查到该实例，而管理端页面下线后查询不到，是因为两者处理实例状态的方式不同：SDK删除可能仅影响服务发现，不改变全局状态；管理端下线则全局标记实例为下线，使其在所有查询中均不可见。


<font color="#949494">---------------</font> 


## 参考链接 ：

*专家经验:CatalogController 里面的接口和客户端SDK的API区别是什么 
 
 *[Nacos功能和需求列表](https://nacos.io/docs/latest/archive/feature-list)
 
 *[鉴权插件](https://nacos.io/docs/latest/plugin/auth-plugin)


 <font color="#949494">---------------</font> 
 


## <font color="#FF0000">答疑服务说明：</font> 

本内容经由技术专家审阅的用户问答的镜像生成，我们提供了<font color="#FF0000">专家智能答疑服务</font>，在<font color="#FF0000">页面的右下的浮窗”专家答疑“</font>。您也可以访问 : [全局专家答疑](https://opensource.alibaba.com/chatBot) 。 咨询其他产品的的问题

### 反馈
如问答有错漏，欢迎点：[差评](https://ai.nacos.io/user/feedbackByEnhancerGradePOJOID?enhancerGradePOJOId=11565)给我们反馈。
