<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="quick-start-spring-cloud" />
	<meta name="description" content="quick-start-spring-cloud" />
	<!-- 网页标签标题 -->
	<title>quick-start-spring-cloud</title>
	<link rel="shortcut icon" href="/img/nacos.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot="" data-reactid="1" data-react-checksum="1245343917"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/en-us/index.html" data-reactid="4"><img class="logo" src="/img/nacos_colorful.png" data-reactid="5"/></a><span class="language-switch language-switch-normal" data-reactid="6">中</span><div class="header-menu" data-reactid="7"><img class="header-menu-toggle" src="/img/menu_gray.png" data-reactid="8"/><ul data-reactid="9"><li class="menu-item menu-item-normal" data-reactid="10"><a href="/en-us/index.html" data-reactid="11">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active" data-reactid="12"><a href="/en-us/docs/quick-start.html" data-reactid="13">DOCS</a></li><li class="menu-item menu-item-normal" data-reactid="14"><a href="/en-us/blog" data-reactid="15">BLOG</a></li><li class="menu-item menu-item-normal" data-reactid="16"><a href="/en-us/community" data-reactid="17">COMMUNITY</a></li></ul></div></div></header><div class="bar" data-reactid="18"><div class="bar-body" data-reactid="19"><img src="/img/docs.png" class="front-img" data-reactid="20"/><div class="bar-title" data-reactid="21"><span data-reactid="22">Documentation</span><div class="bone bone-light" data-reactid="23"></div></div><img src="/img/docs.png" class="back-img" data-reactid="24"/></div></div><section class="content-section" data-reactid="25"><div class="content-body" data-reactid="26"><div class="sidemenu" data-reactid="27"><div class="sidemenu-toggle" data-reactid="28"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png" data-reactid="29"/></div><ul data-reactid="30"><li class="menu-item menu-item-level-1" data-reactid="31"><span data-reactid="32">Nacos </span><ul data-reactid="33"><li style="height:144px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="34"><span data-reactid="35"><!-- react-text: 36 -->What is Nacos<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="37"/></span><ul data-reactid="38"><li class="menu-item menu-item-level-3" data-reactid="39"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="40">What is Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="41"><a href="/en-us/docs/concepts.html" target="_self" data-reactid="42">Concepts</a></li><li class="menu-item menu-item-level-3" data-reactid="43"><a href="/en-us/docs/architecture.html" target="_self" data-reactid="44">Architecure</a></li></ul></li><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="45"><span data-reactid="46"><!-- react-text: 47 -->Quick Start<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="48"/></span><ul data-reactid="49"><li class="menu-item menu-item-level-3" data-reactid="50"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="51">Nacos Quick Start</a></li><li class="menu-item menu-item-level-3" data-reactid="52"><a href="/en-us/docs/quick-start-spring.html" target="_self" data-reactid="53">Quick Start Spring</a></li><li class="menu-item menu-item-level-3" data-reactid="54"><a href="/en-us/docs/quick-start-spring-boot.html" target="_self" data-reactid="55">Quick Start Spring Boot</a></li><li class="menu-item menu-item-level-3" data-reactid="56"><a href="/en-us/docs/quick-start-spring-cloud.html" target="_self" data-reactid="57">Quick Start Spring Cloud</a></li></ul></li><li style="height:144px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="58"><span data-reactid="59"><!-- react-text: 60 -->User Guide<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="61"/></span><ul data-reactid="62"><li class="menu-item menu-item-level-3" data-reactid="63"><a href="/en-us/docs/sdk.html" target="_self" data-reactid="64">Java SDK</a></li><li class="menu-item menu-item-level-3" data-reactid="65"><a href="/en-us/docs/other-language.html" target="_self" data-reactid="66">Other Language</a></li><li class="menu-item menu-item-level-3" data-reactid="67"><a href="/en-us/docs/open-API.html" target="_self" data-reactid="68">Open-API</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="69"><span data-reactid="70"><!-- react-text: 71 -->Admin Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="72"/></span><ul data-reactid="73"><li class="menu-item menu-item-level-3" data-reactid="74"><a href="/en-us/docs/deployment.html" target="_self" data-reactid="75">Deployment Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="76"><a href="/en-us/docs/cluster-mode-quick-start.html" target="_self" data-reactid="77">Cluster Mode Deployment</a></li><li class="menu-item menu-item-level-3" data-reactid="78"><a href="/en-us/docs/managementAPI.html" target="_self" data-reactid="79">Management OpenAPI</a></li><li class="menu-item menu-item-level-3" data-reactid="80"><a href="/en-us/docs/CLI-guide.html" target="_self" data-reactid="81">Nacos Operator CLI Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="82"><a href="/en-us/docs/console-guide.html" target="_self" data-reactid="83">Admin Console Guide</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="84"><span data-reactid="85"><!-- react-text: 86 -->Contributor Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="87"/></span><ul data-reactid="88"><li class="menu-item menu-item-level-3" data-reactid="89"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="90">Contribute to Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="91"><a href="/zh-cn/docs/activity.html" target="_self" data-reactid="92">Nacos Activity</a></li><li class="menu-item menu-item-level-3" data-reactid="93"><a href="/en-us/docs/pull-request.html" target="_self" data-reactid="94">Pull Request Template</a></li><li class="menu-item menu-item-level-3" data-reactid="95"><a href="/en-us/docs/how-to-reporting-bugs.html" target="_self" data-reactid="96">How to reporting bugs</a></li><li class="menu-item menu-item-level-3" data-reactid="97"><a href="/en-us/docs/roadmap.html" target="_self" data-reactid="98">Nacos RoadMap</a></li><li class="menu-item menu-item-level-3" data-reactid="99"><a href="/en-us/docs/use-nacos-with-springcloud.html" target="_self" data-reactid="100">Nacos with SpringCloud</a></li><li class="menu-item menu-item-level-3" data-reactid="101"><a href="/en-us/docs/use-nacos-with-dubbo.html" target="_self" data-reactid="102">Nacos with Dubbo</a></li><li class="menu-item menu-item-level-3" data-reactid="103"><a href="/en-us/docs/use-nacos-with-kubernetes.html" target="_self" data-reactid="104">Nacos with K8s</a></li><li class="menu-item menu-item-level-3" data-reactid="105"><a href="/en-us/docs/use-nacos-with-istio.html" target="_self" data-reactid="106">Nacos with Istio</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="107"><span data-reactid="108"><!-- react-text: 109 -->Community<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="110"/></span><ul data-reactid="111"><li class="menu-item menu-item-level-3" data-reactid="112"><a href="/en-us/docs/community.html" target="_self" data-reactid="113">Community</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body" data-reactid="114"><p>本文主要面向 Spring Cloud 的使用者，通过两个示例来介绍如何使用 Nacos 来实现分布式环境下的配置管理和服务发现。</p>
<ul>
<li>通过 Nacos Server 和 spring-cloud-starter-alibaba-nacos-config 实现配置的动态变更；</li>
<li>通过 Nacos Server 和 spring-cloud-starter-alibaba-nacos-discovery 实现服务的注册与发现。</li>
</ul>
<h2>前提条件</h2>
<p><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)">您需要先下载 Nacos 并启动 Nacos server。操作步骤参见</span></span> <a href="https://nacos.io/zh-cn/docs/quick-start.html">Nacos 快速入门</a><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)">。</span></span></p>
<h2>启动配置管理</h2>
<p><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)">启动了 Nacos server 后，您就可以参考以下示例代码，为您的 Spring Cloud 应用启动 Nacos 配置管理服务了。完整示例代码请参考</span></span>：<a href="https://github.com/nacos-group/nacos-examples/tree/master/nacos-spring-cloud-example/nacos-spring-cloud-config-example">nacos-spring-cloud-config-example</a></p>
<ol>
<li>添加依赖：</li>
</ol>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
    &lt;version&gt;${latest.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<ol start="2">
<li><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)">在 </span></span><code>bootstrap.properties</code><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)"> 中配置 Nacos server 的地址：</span></span></li>
</ol>
<pre><code>spring.cloud.nacos.config.server-addr=127.0.0.1:8848
</code></pre>
<ol start="3">
<li>在 <code>application.properties</code> 配置应用名：</li>
</ol>
<pre><code>spring.application.name=example
</code></pre>
<p><strong>说明</strong>：之所以需要配置 <code>spring.application.name</code> ，是因为它是构成 Nacos 配置管理 <code>dataId</code> 字段的一部分。</p>
<p>在 Nacos Spring Cloud 中，<code>dataId</code> 的完整格式如下：</p>
<pre><code class="language-plain">${prefix}-${spring.profile.active}.${file-extension}
</code></pre>
<ul>
<li><code>prefix</code> 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li>
<li><code>spring.profile.active</code> 即为当前环境对应的 profile，详情可以参考 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html#boot-features-profiles">Spring Boot文档</a>。
__注意：当 __<code>spring.profile.active</code><strong> 为空时，对应的连接符 </strong><strong><code>-</code></strong><strong> 也将不存在，dataId 的拼接格式变成 </strong><strong><code>${prefix}</code></strong><strong>.</strong><strong><code>${file-extension}</code></strong></li>
<li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 类型。</li>
</ul>
<ol start="4">
<li>通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动更新：</li>
</ol>
<pre><code>@RestController
@RequestMapping(&quot;/config&quot;)
@RefreshScope
public class ConfigController {

    @Value(&quot;${useLocalCache:false}&quot;)
    private boolean useLocalCache;

    @RequestMapping(&quot;/get&quot;)
    public boolean get() {
        return useLocalCache;
    }
}
</code></pre>
<ol start="5">
<li>首先通过调用 <a href="https://nacos.io/zh-cn/docs/open-API.html">Nacos Open API</a> 向 Nacos Server 发布配置：dataId 为<code>example.properties</code>，内容为<code>useLocalCache=true</code></li>
</ol>
<pre><code>curl -X POST &quot;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=example.properties&amp;group=DEFAULT_GROUP&amp;content=useLocalCache=true&quot;
</code></pre>
<ol start="6">
<li>
<p>运行 <code>NacosConfigApplication</code>，调用 <code>curl http://localhost:8080/config/get</code>，返回内容是 <code>true</code>。</p>
</li>
<li>
<p>再次调用 <a href="https://nacos.io/zh-cn/docs/open-API.html">Nacos Open API</a> 向 Nacos server 发布配置：dataId 为<code>example.properties</code>，内容为<code>useLocalCache=false</code></p>
</li>
</ol>
<pre><code>curl -X POST &quot;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=example.properties&amp;group=DEFAULT_GROUP&amp;content=useLocalCache=false&quot;
</code></pre>
<ol start="8">
<li>再次访问 <code>http://localhost:8080/config/get</code>，此时返回内容为<code>false</code>，说明程序中的<code>useLocalCache</code>值已经被动态更新了。</li>
</ol>
<h2>启动服务发现</h2>
<p><span data-type="color" style="color:rgb(38, 38, 38)"><span data-type="background" style="background-color:rgb(255, 255, 255)">本节演示如何在您的 Spring Cloud 项目中启动 Nacos 的服务发现功能。完整示例代码请参考</span></span>：<a href="https://github.com/nacos-group/nacos-examples/tree/master/nacos-spring-cloud-example/nacos-spring-cloud-discovery-example">nacos-spring-cloud-discovery-example</a></p>
<ol>
<li>添加依赖：</li>
</ol>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
    &lt;version&gt;${latest.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<ol start="2">
<li>配置服务提供者，从而<span data-type="color" style="color:rgb(25, 31, 37)"><span data-type="background" style="background-color:rgb(255, 255, 255)">服务提供者可以通过 Nacos 的服务注册发现功能将其服务注册到 Nacos server 上。</span></span></li>
</ol>
<p>i. 在 <code>application.properties</code> 中配置 Nacos server 的地址：</p>
<pre><code>server.port=8070
spring.application.name=service-provider

spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
</code></pre>
<p>ii. 通过 Spring Cloud 原生注解 <code>@EnableDiscoveryClient</code> 开启服务注册发现功能：</p>
<pre><code>@SpringBootApplication
@EnableDiscoveryClient
public class NacosProviderApplication {

	public static void main(String[] args) {
		SpringApplication.run(NacosProviderApplication.class, args);
	}

	@RestController
	class EchoController {
		@RequestMapping(value = &quot;/echo/{string}&quot;, method = RequestMethod.GET)
		public String echo(@PathVariable String string) {
			return &quot;Hello Nacos Discovery &quot; + string;
		}
	}
}
</code></pre>
<ol start="3">
<li>配置服务消费者，从而<span data-type="color" style="color:rgb(25, 31, 37)"><span data-type="background" style="background-color:rgb(255, 255, 255)">服务消费者可以通过 Nacos 的服务注册发现功能从 Nacos server 上获取到它要调用的服务</span></span>。</li>
</ol>
<p>i. 在 <code>application.properties</code> 中配置 Nacos server 的地址：</p>
<pre><code>server.port=8080
spring.application.name=service-consumer

spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
</code></pre>
<p>ii. 通过 Spring Cloud 原生注解 <code>@EnableDiscoveryClient</code>  开启服务注册发现功能。给 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-resttemplate.html">RestTemplate</a> 实例添加  <code>@LoadBalanced</code> 注解，开启 <code>@LoadBalanced</code> 与 <a href="https://cloud.spring.io/spring-cloud-netflix/multi/multi_spring-cloud-ribbon.html">Ribbon</a> 的集成：</p>
<pre><code>@SpringBootApplication
@EnableDiscoveryClient
public class NacosConsumerApplication {

    @LoadBalanced
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }

    public static void main(String[] args) {
        SpringApplication.run(NacosConsumerApplication.class, args);
    }

    @RestController
    public class TestController {

        private final RestTemplate restTemplate;

        @Autowired
        public TestController(RestTemplate restTemplate) {this.restTemplate = restTemplate;}

        @RequestMapping(value = &quot;/echo/{str}&quot;, method = RequestMethod.GET)
        public String echo(@PathVariable String str) {
            return restTemplate.getForObject(&quot;http://service-provider/echo/&quot; + str, String.class);
        }
    }
}
</code></pre>
<ol start="4">
<li>启动 <code>ProviderApplication</code> 和 <code>ConsumerApplication</code> ，调用 <code>http://localhost:8080/echo/2018</code>，返回内容为 <code>Hello Nacos Discovery 2018</code>。</li>
</ol>
<h2>相关项目</h2>
<ul>
<li><a href="https://github.com/alibaba/nacos">Nacos</a></li>
<li><a href="https://github.com/nacos-group/nacos-spring-project">Nacos Spring</a></li>
<li><a href="https://github.com/nacos-group/nacos-spring-boot-project">Nacos Spring Boot</a></li>
<li><a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba">Spring Cloud</a> <a href="https://github.com/spring-cloud-incubator/spring-cloud-alibaba">Alibaba</a></li>
</ul>
</div></div></section><footer class="footer-container" data-reactid="115"><div class="footer-body" data-reactid="116"><img src="/img/nacos_gray.png" data-reactid="117"/><div class="cols-container" data-reactid="118"><div class="col col-12" data-reactid="119"><h3 data-reactid="120">Vision</h3><p data-reactid="121">By providing an easy-to-use service infrastructure such as dynamic service discovery, service configuration, service sharing and management and etc., Nacos help users better construct, deliver and manage their own service platform, reuse and composite business service faster and deliver value of business innovation more quickly so as to win market for users in the era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class="col col-6" data-reactid="122"><dl data-reactid="123"><dt data-reactid="124">Documentation</dt><dd data-reactid="125"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="126">Overview</a></dd><dd data-reactid="127"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="128">Quick start</a></dd><dd data-reactid="129"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="130">Developer guide</a></dd></dl></div><div class="col col-6" data-reactid="131"><dl data-reactid="132"><dt data-reactid="133">Resources</dt><dd data-reactid="134"><a href="/en-us/community/index.html" target="_self" data-reactid="135">Community</a></dd></dl></div></div><div class="copyright" data-reactid="136"><span data-reactid="137">@ 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>