<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="monitor-guide" />
	<meta name="description" content="monitor-guide" />
	<!-- 网页标签标题 -->
	<title>monitor-guide</title>
	<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB12DhvCwHqK1RjSZFEXXcGMXXa-64-64.png"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot="" data-reactid="1" data-react-checksum="-502882730"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/en-us/index.html" data-reactid="4"><img class="logo" src="/img/nacos_colorful.png" data-reactid="5"/></a><span class="language-switch language-switch-normal" data-reactid="6">中</span><div class="header-menu" data-reactid="7"><img class="header-menu-toggle" src="/img/menu_gray.png" data-reactid="8"/><ul data-reactid="9"><li class="menu-item menu-item-normal" data-reactid="10"><a href="/en-us/index.html" data-reactid="11">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active" data-reactid="12"><a href="/en-us/docs/quick-start.html" data-reactid="13">DOCS</a></li><li class="menu-item menu-item-normal" data-reactid="14"><a href="/en-us/docs/nacos-dev.html" data-reactid="15">DEVELOPERS</a></li><li class="menu-item menu-item-normal" data-reactid="16"><a href="/en-us/blog" data-reactid="17">BLOG</a></li><li class="menu-item menu-item-normal" data-reactid="18"><a href="/en-us/community" data-reactid="19">COMMUNITY</a></li><li class="menu-item menu-item-normal" data-reactid="20"><a href="/en-us/blog/download.html" data-reactid="21">DOWNLOAD</a></li><li class="menu-item menu-item-normal" data-reactid="22"><a href="http://console.nacos.io/nacos/index.html" data-reactid="23">DEMO-CONSOLE</a></li></ul></div></div></header><div class="bar" data-reactid="24"><div class="bar-body" data-reactid="25"><img src="/img/docs.png" class="front-img" data-reactid="26"/><div class="bar-title" data-reactid="27"><span data-reactid="28">Documentation</span><div class="bone bone-light" data-reactid="29"></div></div><img src="/img/docs.png" class="back-img" data-reactid="30"/></div></div><section class="content-section" data-reactid="31"><div class="content-body" data-reactid="32"><div class="sidemenu" data-reactid="33"><div class="sidemenu-toggle" data-reactid="34"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png" data-reactid="35"/></div><ul data-reactid="36"><li class="menu-item menu-item-level-1" data-reactid="37"><span data-reactid="38">Nacos </span><ul data-reactid="39"><li style="height:144px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="40"><span data-reactid="41"><!-- react-text: 42 -->What is Nacos<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="43"/></span><ul data-reactid="44"><li class="menu-item menu-item-level-3" data-reactid="45"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="46">What is Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="47"><a href="/en-us/docs/concepts.html" target="_self" data-reactid="48">Concepts</a></li><li class="menu-item menu-item-level-3" data-reactid="49"><a href="/en-us/docs/architecture.html" target="_self" data-reactid="50">Architecure</a></li></ul></li><li style="height:288px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="51"><span data-reactid="52"><!-- react-text: 53 -->Quick Start<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="54"/></span><ul data-reactid="55"><li class="menu-item menu-item-level-3" data-reactid="56"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="57">Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="58"><a href="/en-us/docs/quick-start-spring.html" target="_self" data-reactid="59">Nacos Spring</a></li><li class="menu-item menu-item-level-3" data-reactid="60"><a href="/en-us/docs/quick-start-spring-boot.html" target="_self" data-reactid="61">Nacos Spring Boot</a></li><li class="menu-item menu-item-level-3" data-reactid="62"><a href="/en-us/docs/quick-start-spring-cloud.html" target="_self" data-reactid="63">Nacos Spring Cloud</a></li><li class="menu-item menu-item-level-3" data-reactid="64"><a href="/en-us/docs/quick-start-docker.html" target="_self" data-reactid="65">Nacos Docker</a></li><li class="menu-item menu-item-level-3" data-reactid="66"><a href="/en-us/docs/use-nacos-with-dubbo.html" target="_self" data-reactid="67">Nacos with Dubbo</a></li><li class="menu-item menu-item-level-3" data-reactid="68"><a href="/en-us/docs/use-nacos-with-kubernetes.html" target="_self" data-reactid="69">Nacos with K8s</a></li></ul></li><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="70"><span data-reactid="71"><!-- react-text: 72 -->User Guide<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="73"/></span><ul data-reactid="74"><li class="menu-item menu-item-level-3" data-reactid="75"><a href="/en-us/docs/sdk.html" target="_self" data-reactid="76">Java SDK</a></li><li class="menu-item menu-item-level-3" data-reactid="77"><a href="/en-us/docs/other-language.html" target="_self" data-reactid="78">Other Language</a></li><li class="menu-item menu-item-level-3" data-reactid="79"><a href="/en-us/docs/open-API.html" target="_self" data-reactid="80">Open-API</a></li><li class="menu-item menu-item-level-3" data-reactid="81"><a href="/en-us/docs/nacos-spring.html" target="_self" data-reactid="82">Nacos Spring</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="83"><span data-reactid="84"><!-- react-text: 85 -->Admin Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="86"/></span><ul data-reactid="87"><li class="menu-item menu-item-level-3" data-reactid="88"><a href="/en-us/docs/deployment.html" target="_self" data-reactid="89">Deployment Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="90"><a href="/en-us/docs/cluster-mode-quick-start.html" target="_self" data-reactid="91">Cluster Mode Deployment</a></li><li class="menu-item menu-item-level-3" data-reactid="92"><a href="/en-us/docs/managementAPI.html" target="_self" data-reactid="93">Management OpenAPI</a></li><li class="menu-item menu-item-level-3" data-reactid="94"><a href="/en-us/docs/CLI-guide.html" target="_self" data-reactid="95">Nacos Operator CLI Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="96"><a href="/en-us/docs/console-guide.html" target="_self" data-reactid="97">Admin Console Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="98"><a href="/en-us/docs/monitor-guide.html" target="_self" data-reactid="99">Nacos Monitor Guide</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="100"><span data-reactid="101"><!-- react-text: 102 -->Contributor Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="103"/></span><ul data-reactid="104"><li class="menu-item menu-item-level-3" data-reactid="105"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="106">Contribute to Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="107"><a href="/zh-cn/docs/activity.html" target="_self" data-reactid="108">Nacos Activity</a></li><li class="menu-item menu-item-level-3" data-reactid="109"><a href="/en-us/docs/pull-request.html" target="_self" data-reactid="110">Pull Request Template</a></li><li class="menu-item menu-item-level-3" data-reactid="111"><a href="/en-us/docs/how-to-reporting-bugs.html" target="_self" data-reactid="112">How to reporting bugs</a></li><li class="menu-item menu-item-level-3" data-reactid="113"><a href="/en-us/docs/roadmap.html" target="_self" data-reactid="114">Nacos RoadMap</a></li><li class="menu-item menu-item-level-3" data-reactid="115"><a href="/en-us/docs/use-nacos-with-istio.html" target="_self" data-reactid="116">Nacos with Istio</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="117"><span data-reactid="118"><!-- react-text: 119 -->Community<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="120"/></span><ul data-reactid="121"><li class="menu-item menu-item-level-3" data-reactid="122"><a href="/en-us/docs/community.html" target="_self" data-reactid="123">Community</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body" data-reactid="124"><p>Nacos 0.8.0 improves the monitoring system, supporting Nacos operation status monitoring through exposing metrics data access to third-party monitoring system. Currently, prometheus, elastic search and influxdb are supported. The docs introduce how prometheus and grafana monitor Nacos. You can find out for yourself how to use elastic search and influxdb.</p>
<h2>Deploy Nacos cluster to expose metrics data</h2>
<p>Deploy the Nacos cluster according to <a href="https://nacos.io/en-us/docs/deployment.html">the deploy document</a></p>
<p>Configure the application. properties file to expose metrics data</p>
<pre><code>management.endpoints.web.exposure.include=*
</code></pre>
<p>Access {ip}:8848/nacos/actuator/prometheus to see if metrics data can be accessed</p>
<h2>Deploy prometheus to collect Nacos metrics data</h2>
<p>Download the Prometheus version you want to install at the address of <a href="https://prometheus.io/download/">download prometheus</a></p>
<h3>linux &amp; mac</h3>
<p>Decompress prometheus compression package</p>
<pre><code>tar xvfz prometheus-*.tar.gz
cd prometheus-*
</code></pre>
<p>Modify configuration file prometheus.yml to collect Nacos metrics data</p>
<pre><code>    metrics_path: '/nacos/actuator/prometheus'
    static_configs:
      - targets:['{ip1}:8848','{ip2}:8848','{ip3}:8848']
</code></pre>
<p>Start prometheus service</p>
<pre><code>./prometheus --config.file=&quot;prometheus.yml&quot;
</code></pre>
<h3>windows</h3>
<p>Download the corresponding version of Windows and decompress it</p>
<p>Modify configuration file prometheus.yml to collect Nacos metrics data</p>
<pre><code>    metrics_path: '/nacos/actuator/prometheus'
    static_configs:
      - targets:['{ip1}:8848','{ip2}:8848','{ip3}:8848']
</code></pre>
<p>Start prometheus service</p>
<pre><code>prometheus.exe --config.file=prometheus.yml
</code></pre>
<p>By accessing http://{ip}:9090/graph, we can see the data collected by prometheus. By searching nacos_monitor in the search bar, we can find Nacos data to show the success of the data collection.
<img src="https://img.alicdn.com/tfs/TB1LThVCQvoK1RjSZFwXXciCFXa-2832-1576.png" alt="IMAGE"></p>
<h2>Deploy grafana to graphically display metrics data</h2>
<p>Install grafana on the same machine as prometheus, and use yum to install grafana</p>
<h3>mac</h3>
<pre><code>brew install grafana
brew services start grafana
</code></pre>
<h3>linux</h3>
<pre><code>sudo yum install https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana-4.4.3-1.x86_64.rpm
sudo service grafana-server start
</code></pre>
<h3>windows</h3>
<p>Reference document：<a href="http://docs.grafana.org/installation/windows/">http://docs.grafana.org/installation/windows/</a></p>
<p>Access grafana: http://{ip}:3000</p>
<p>Configuring prometheus data source
<img src="https://img.alicdn.com/tfs/TB1bTafCOLaK1RjSZFxXXamPFXa-2832-1568.png" alt="IMAGE"></p>
<p>Import Nacos grafana monitoring <a href="https://github.com/nacos-group/nacos-template/blob/master/nacos-grafana.json">template</a>
<img src="https://img.alicdn.com/tfs/TB1JadVCPDpK1RjSZFrXXa78VXa-2742-1338.png" alt="IMAGE"></p>
<p>Nacos monitoring is divided into three modules:</p>
<ul>
<li>nacos monitor shows core monitoring items
<img src="https://img.alicdn.com/tfs/TB1PMpUCQvoK1RjSZFDXXXY3pXa-2832-1584.png" alt="IMAGE"></li>
<li>nacos detail shows the change curve of index
<img src="https://img.alicdn.com/tfs/TB1ZBF4CNjaK1RjSZFAXXbdLFXa-2742-1480.png" alt="IMAGE"></li>
<li>nacos alert is alerts about nacos
<img src="https://img.alicdn.com/tfs/TB1ALlUCFzqK1RjSZFCXXbbxVXa-2742-1476.png" alt="IMAGE"></li>
</ul>
<h2>configure grafana alert</h2>
<p>When Nacos runs out of order, Grafana can alert the person in charge. Grafana supports a variety of police alert. Mail, DingTalk and webhook are commonly used.</p>
<h3>DingTalk alert</h3>
<p>Configure DingTalk robots
<img src="https://img.alicdn.com/tfs/TB1eJ0RCSzqK1RjSZFjXXblCFXa-2742-1482.png" alt="IMAGE"></p>
<p>Configure DingTalk robots url
<img src="https://img.alicdn.com/tfs/TB1ERtQCSzqK1RjSZFjXXblCFXa-2832-1578.png" alt="IMAGE"></p>
<p>Test alert
<img src="https://img.alicdn.com/tfs/TB1KvXPCHPpK1RjSZFFXXa5PpXa-996-504.png" alt="IMAGE"></p>
<h3>mail alert</h3>
<p>Modify defaults.ini configuration file to add mail alerts</p>
<pre><code>#################################### SMTP / Emailing ##########################
[smtp]
enabled = true
host = smtp.126.com:25
user = xxxxxx
password = xxxxx
;cert_file =
;key_file =
skip_verify = true
from_address = xxxxxx@126.com

[emails]
;welcome_email_on_sign_up = false
</code></pre>
<p>Configuration notification mailbox
<img src="https://img.alicdn.com/tfs/TB12qyhCNnaK1RjSZFtXXbC2VXa-2832-1576.png" alt="IMAGE"></p>
<h2>meaning of Nacos metrics</h2>
<h3>jvm metrics</h3>
<table>
<thead>
<tr>
<th>item</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>system_cpu_usage</td>
<td>cpu usage</td>
</tr>
<tr>
<td>system_load_average_1m</td>
<td>load</td>
</tr>
<tr>
<td>jvm_memory_used_bytes</td>
<td>jvm memory used(bytes)</td>
</tr>
<tr>
<td>jvm_memory_max_bytes</td>
<td>jvm memory max(bytes)</td>
</tr>
<tr>
<td>jvm_gc_pause_seconds_count</td>
<td>gc count</td>
</tr>
<tr>
<td>jvm_gc_pause_seconds_sum</td>
<td>gc time</td>
</tr>
<tr>
<td>jvm_threads_daemon</td>
<td>jvm threads count</td>
</tr>
</tbody>
</table>
<h3>Nacos metrics</h3>
<table>
<thead>
<tr>
<th>item</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>http_server_requests_seconds_count</td>
<td>http requests count</td>
</tr>
<tr>
<td>http_server_requests_seconds_sum</td>
<td>http requests time</td>
</tr>
<tr>
<td>nacos_timer_seconds_sum</td>
<td>Nacos config notify time</td>
</tr>
<tr>
<td>nacos_timer_seconds_count</td>
<td>Nacos config notify count</td>
</tr>
<tr>
<td>nacos_monitor{name='longPolling'}</td>
<td>Nacos config connection count</td>
</tr>
<tr>
<td>nacos_monitor{name='configCount'}</td>
<td>Nacos configuration file count</td>
</tr>
<tr>
<td>nacos_monitor{name='dumpTask'}</td>
<td>Nacos config dump task count</td>
</tr>
<tr>
<td>nacos_monitor{name='notifyTask'}</td>
<td>Nacos config notify task count</td>
</tr>
<tr>
<td>nacos_monitor{name='getConfig'}</td>
<td>Nacos config read configuration count</td>
</tr>
<tr>
<td>nacos_monitor{name='publish'}</td>
<td>Nacos config update configuration count</td>
</tr>
<tr>
<td>nacos_monitor{name='ipCount'}</td>
<td>Nacos naming ip count</td>
</tr>
<tr>
<td>nacos_monitor{name='domCount'}</td>
<td>Nacos naming domain count</td>
</tr>
<tr>
<td>nacos_monitor{name='failedPush'}</td>
<td>Nacos naming push fail count</td>
</tr>
<tr>
<td>nacos_monitor{name='avgPushCost'}</td>
<td>Nacos naming push cost time(average)</td>
</tr>
<tr>
<td>nacos_monitor{name='leaderStatus'}</td>
<td>Nacos naming if node is leader</td>
</tr>
<tr>
<td>nacos_monitor{name='maxPushCost'}</td>
<td>Nacos naming push cost time(max)</td>
</tr>
<tr>
<td>nacos_monitor{name='mysqlhealthCheck'}</td>
<td>Nacos naming mysql health check count</td>
</tr>
<tr>
<td>nacos_monitor{name='httpHealthCheck'}</td>
<td>Nacos naming http health check count</td>
</tr>
<tr>
<td>nacos_monitor{name='tcpHealthCheck'}</td>
<td>Nacos naming tcp health check count</td>
</tr>
</tbody>
</table>
<h3>nacos exception</h3>
<table>
<thead>
<tr>
<th>item</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>nacos_exception_total{name='db'}</td>
<td>database exception</td>
</tr>
<tr>
<td>nacos_exception_total{name='configNotify'}</td>
<td>Nacos config notify exception</td>
</tr>
<tr>
<td>nacos_exception_total{name='unhealth'}</td>
<td>Nacos config server health check exception</td>
</tr>
<tr>
<td>nacos_exception_total{name='disk'}</td>
<td>Nacos naming write disk exception</td>
</tr>
<tr>
<td>nacos_exception_total{name='leaderSendBeatFailed'}</td>
<td>Nacos naming leader send heart beat fail count</td>
</tr>
<tr>
<td>nacos_exception_total{name='illegalArgument'}</td>
<td>request argument illegal count</td>
</tr>
<tr>
<td>nacos_exception_total{name='nacos'}</td>
<td>Nacos inner exception</td>
</tr>
</tbody>
</table>
<h3>client metrics</h3>
<table>
<thead>
<tr>
<th>item</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>nacos_monitor{name='subServiceCount'}</td>
<td>subscribed services count</td>
</tr>
<tr>
<td>nacos_monitor{name='pubServiceCount'}</td>
<td>published services count</td>
</tr>
<tr>
<td>nacos_monitor{name='configListenSize'}</td>
<td>listened configuration file count</td>
</tr>
<tr>
<td>nacos_client_request_seconds_count</td>
<td>request count</td>
</tr>
<tr>
<td>nacos_client_request_seconds_sum</td>
<td>request time</td>
</tr>
</tbody>
</table>
</div></div></section><footer class="footer-container" data-reactid="125"><div class="footer-body" data-reactid="126"><img src="/img/nacos_gray.png" data-reactid="127"/><div class="cols-container" data-reactid="128"><div class="col col-12" data-reactid="129"><h3 data-reactid="130">Vision</h3><p data-reactid="131">By providing an easy-to-use service infrastructure such as dynamic service discovery, service configuration, service sharing and management and etc., Nacos help users better construct, deliver and manage their own service platform, reuse and composite business service faster and deliver value of business innovation more quickly so as to win market for users in the era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class="col col-6" data-reactid="132"><dl data-reactid="133"><dt data-reactid="134">Documentation</dt><dd data-reactid="135"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="136">Overview</a></dd><dd data-reactid="137"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="138">Quick start</a></dd><dd data-reactid="139"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="140">Developer guide</a></dd></dl></div><div class="col col-6" data-reactid="141"><dl data-reactid="142"><dt data-reactid="143">Resources</dt><dd data-reactid="144"><a href="/en-us/community/index.html" target="_self" data-reactid="145">Community</a></dd><dd data-reactid="146"><a href="https://www.aliyun.com/product/acm?source_type=nacos_pc_20181219" target="_self" data-reactid="147">Cloud Service ACM</a></dd><dd data-reactid="148"><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self" data-reactid="149">Cloud Service EDAS</a></dd></dl></div></div><div class="copyright" data-reactid="150"><span data-reactid="151">@ 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>