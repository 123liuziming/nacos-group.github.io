{
  "filename": "nacos-config-benchmark.md",
  "__html": "<p>#Nacos服务配置性能测试报告</p>\n<p>##测试目的\n主要让大家了解Nacos的性能负载和容量，协助我们更好的管理Nacos性能质量，帮助用户更快的运用评估Nacos系统负荷。</p>\n<p>##测试工具\n我们使用自研的PAS性能评估服务平台进行压测，其原理是基于利用JMeter引擎，使用PAS自动生成的JMeter脚本，进行智能压测。</p>\n<p><img src=\"https://img.alicdn.com/tfs/TB1xCfDDpzqK1RjSZFvXXcB7VXa-692-297.png\" alt=\"IMAGE\"></p>\n<p>##测试环境\n###1.环境</p>\n<table>\n<thead>\n<tr>\n<th>指标</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>机器</td>\n<td>CPU 8核，内存16G</td>\n</tr>\n<tr>\n<td>集群规模</td>\n<td>单机，3节点，10节点，100节点</td>\n</tr>\n<tr>\n<td>Nacos版本</td>\n<td>0.8.0</td>\n</tr>\n<tr>\n<td>数据库</td>\n<td>32C128G</td>\n</tr>\n</tbody>\n</table>\n<p>###2.设置启动参数</p>\n<pre><code>/opt/taobao/java/bin/java -server -Xms4g -Xmx4g -Xmn2g \n-XX:MetaspaceSize=128m \n-XX:MaxMetaspaceSize=320m \n-Xdebug \n-Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n \n-XX:+UseConcMarkSweepGC \n-XX:+UseCMSCompactAtFullCollection \n-XX:CMSInitiatingOccupancyFraction=70 \n-XX:+CMSParallelRemarkEnabled -XX:SoftRefLRUPolicyMSPerMB=0 \n-XX:+CMSClassUnloadingEnabled -XX:SurvivorRatio=8 \n-XX:-UseParNewGC -verbose:gc -Xloggc:/home/admin/nacos/logs/nacos_gc.log \n-XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime \n-XX:+PrintAdaptiveSizePolicy -Dnacos.home=/home/admin/nacos -XX:-OmitStackTraceInFastThrow \n-XX:-UseLargePages -jar /home/admin/nacos/target/nacos-server.jar \n--spring.config.location=classpath:/,classpath:/config/,file:./,file:./config/,file:/home/admin/nacos/conf/\n</code></pre>\n<p>##测试场景\n以下测试场景都是服务配置重要接口：</p>\n<ul>\n<li>验证Nacos服务发布配置的能力</li>\n<li>验证Nacos服务获取配置的能力</li>\n<li>验证Nacos服务监听配置的能力</li>\n<li>验证Nacos服务长连接容量能力</li>\n</ul>\n<p>##测试数据\n###1. 发布配置\n发布配置主要测试Nacos publishConfig接口的性能。<br>\n在各规模集群的性能表现：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">单机</th>\n<th style=\"text-align:center\">3节点</th>\n<th style=\"text-align:center\">10节点</th>\n<th style=\"text-align:center\">100节点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">1400</td>\n<td style=\"text-align:center\">4214</td>\n<td style=\"text-align:center\">6863</td>\n<td style=\"text-align:center\">8626</td>\n</tr>\n</tbody>\n</table>\n<p>具体我们看下3节点服务集群发布配置能力。<br>\n以下为各个并发数 (施压机台数*并发数) 时，发布配置的TPS，平均RT。\n<img src=\"https://img.alicdn.com/tfs/TB1OjzIDpzqK1RjSZFoXXbfcXXa-693-400.png\" alt=\"IMAGE\">\n<img src=\"https://img.alicdn.com/tfs/TB1s.EfDxjaK1RjSZKzXXXVwXXa-693-325.png\" alt=\"IMAGE\"></p>\n<p>###2. 获取配置\n获取配置对Nacos getConfig接口进行测试。<br>\n实测在各个规模集群的性能表现：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">单机</th>\n<th style=\"text-align:center\">3节点</th>\n<th style=\"text-align:center\">10节点</th>\n<th style=\"text-align:center\">100节点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">15000</td>\n<td style=\"text-align:center\">23013</td>\n<td style=\"text-align:center\">45000</td>\n<td style=\"text-align:center\">161099</td>\n</tr>\n</tbody>\n</table>\n<p>具体我们也看下3节点服务集群获取配置能力，<br>\n以下为各个并发数 (施压机台数*并发数) 时，获取配置的TPS，平均RT。\n<img src=\"https://img.alicdn.com/tfs/TB1UjzDDr2pK1RjSZFsXXaNlXXa-691-365.png\" alt=\"IMAGE\">\n<img src=\"https://img.alicdn.com/tfs/TB1kcfADwTqK1RjSZPhXXXfOFXa-691-380.png\" alt=\"IMAGE\"></p>\n<p>###3. 监听配置\n执行Nacos addListeners的接口的性能， 监听配置主要采用增加多个配置监听，并多次发布配置的方法，统计发布时间与监听接收到配置时间间隔。<br>\n我们选取了几个点，列举了发布与监听时间差，在100ms内基本都能监听到配置的更改。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">次数</th>\n<th style=\"text-align:center\">发布与监听时间差(ms)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">63</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">53</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">3</td>\n<td style=\"text-align:center\">84</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">4</td>\n<td style=\"text-align:center\">73</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">5</td>\n<td style=\"text-align:center\">46</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">6</td>\n<td style=\"text-align:center\">35</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">7</td>\n<td style=\"text-align:center\">73</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">8</td>\n<td style=\"text-align:center\">183</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">9</td>\n<td style=\"text-align:center\">104</td>\n</tr>\n</tbody>\n</table>\n<p>###4. 长连接容量测试\nNacos监听配置与客户端建立长连接，长连接会消耗服务内存，从而集群load增高。建立长连接容量的能力，主要考查配置监听的瓶颈。<br>\n测试方法逐渐增加集群的连接，单机连接达到9000时，CPU: 13.9% 内存：18.8%，load：4.7，都处于正常状态，连接数量增加后，load会成倍数级增加。<br>\n在各规模集群测试基本上符合验证。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">单机</th>\n<th style=\"text-align:center\">3节点</th>\n<th style=\"text-align:center\">10节点</th>\n<th style=\"text-align:center\">100节点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">9000</td>\n<td style=\"text-align:center\">27000</td>\n<td style=\"text-align:center\">90000</td>\n<td style=\"text-align:center\">910000</td>\n</tr>\n</tbody>\n</table>\n<p>##测试结论\nNacos性能测试都是针对重点功能，通过对各规模集群进行压测，可以看到各个集群的接口容量。<br>\n本测试供给大家作为参考，如有不足或偏差，请指正！<br>\n如果对性能有其他需求，可以给我们提issue。</p>\n"
}