{
  "filename": "nacos-deploy-mysql8.md",
  "__html": "<h1>Nacos 配置MySQL8数据库</h1>\n<p><code>Nacos版本：1.1.3</code></p>\n<p><code>MySQL版本：8.0.15</code></p>\n<h2>从GitHub上获取Nacos源码</h2>\n<pre><code class=\"language-sh\">git <span class=\"hljs-built_in\">clone</span> https://github.com/alibaba/nacos.git\n</code></pre>\n<h2>初始化mysql数据库</h2>\n<p><code>脚本文件位置：nacos/distribution/conf/nacos-mysql.sql</code></p>\n<pre><code class=\"language-mysql\">-- 创建nacos_config数据库\ncreate database `nacos_config` default character set utf8mb4 collate utf8mb4_general_ci;\nuse `nacos_config`;\n</code></pre>\n<h2>修改pom文件里的mysql驱动版本</h2>\n<p><code>位置：在父pom文件中，line 643</code></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-comment\">&lt;!-- JDBC libs --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-comment\">&lt;!-- &lt;version&gt;5.1.34&lt;/version&gt; --&gt;</span>\n    <span class=\"hljs-comment\">&lt;!-- 更换为支持MySQL8驱动的版本 --&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>8.0.17<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h2>修改源代码</h2>\n<p><code>修改数据源</code></p>\n<p><code>位置：nacos/naming/src/main/java/com/alibaba/nacos/naming/healthcheck/MysqlHealthCheckProcessor.java</code></p>\n<pre><code class=\"language-java\"><span class=\"hljs-comment\">// import com.mysql.jdbc.jdbc2.optional.MysqlDataSource;原本引用的类</span>\n<span class=\"hljs-comment\">// com.mysql.cj.jdbc.MysqlDataSource是通过定位源码的位置找到的</span>\n<span class=\"hljs-keyword\">import</span> com.mysql.cj.jdbc.MysqlDataSource;\n</code></pre>\n<h2>修改配置文件，添加支持mysql数据源配置</h2>\n<p><code>配置文件位置：nacos/distribution/conf/application.properties</code></p>\n<pre><code class=\"language-properties\"><span class=\"hljs-meta\">spring.datasource.platform</span>=<span class=\"hljs-string\">mysql</span>\n<span class=\"hljs-meta\">spring.datasource.driver-class-name</span>=<span class=\"hljs-string\">com.mysql.cj.jdbc.Driver</span>\n<span class=\"hljs-meta\">db.num</span>=<span class=\"hljs-string\">1</span>\n<span class=\"hljs-meta\">db.url.0</span>=<span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span>\n<span class=\"hljs-meta\">db.user</span>=<span class=\"hljs-string\">userName</span>\n<span class=\"hljs-meta\">db.password</span>=<span class=\"hljs-string\">password</span>\n</code></pre>\n<h2>打包编译</h2>\n<pre><code class=\"language-shell\">cd nacos/\nmvn -Prelease-nacos clean install -U -Dmaven.test.skip=true\n</code></pre>\n<h2>Linux环境下单机模式启动命令</h2>\n<pre><code class=\"language-shell\"><span class=\"hljs-meta\">#</span><span class=\"bash\"> 单机模式启动</span>\nnohup sh startup.sh -m standalone &amp;\n<span class=\"hljs-meta\">\n#</span><span class=\"bash\"> 查看启动日志</span>\nvim /usr/local/nacos/distribution/target/nacos-server-1.1.3/nacos/logs/start.out\n</code></pre>\n<h2>问题排查</h2>\n<p><code>问题</code></p>\n<pre><code class=\"language-tex\">Caused by: java.lang.NullPointerException at com.mysql.jdbc.ConnectionImpl.getServerCharset(ConnectionImpl.java:2983)\n</code></pre>\n<p><code>分析：源代码与使用的Mysql8驱动不一致导致，参考上面的更换驱动部分</code></p>\n<p><code>问题</code></p>\n<pre><code class=\"language-tex\">[ERROR] nacos/naming/src/main/java/com/alibaba/nacos/naming/healthcheck/MysqlHealthCheckProcessor.java:[24,37] 程序包com.mysql.jdbc.jdbc2.optional不存在\n</code></pre>\n<p><code>分析：由于pom文件更改了mysql驱动版本，所以源代码也需要作出相应改动，参考上面的修改源代码部分</code></p>\n",
  "link": "/zh-cn/blog/nacos-deploy-mysql8.html",
  "meta": {
    "title": "Nacos 配置MySQL8数据库",
    "keywords": "mysql8,nacos",
    "description": "Nacos 配置MySQL8数据库"
  }
}