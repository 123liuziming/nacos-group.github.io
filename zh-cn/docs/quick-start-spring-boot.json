{
  "filename": "quick-start-spring-boot.md",
  "__html": "<h1>前提条件</h1>\n<p>请先参看 <a href=\"https://nacos.io/zh-cn/docs/quick-start.html\">Nacos 快速入门</a>，下载 Nacos Server 并启动服务。</p>\n<h1>配置管理</h1>\n<p><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\">完整示例代码：</span></span><a href=\"https://github.com/nacos-group/nacos-demo/nacos-spring-boot-config-demo\">nacos-spring-boot-config-example</a></p>\n<h2>依赖</h2>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;nacos-config-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;${latest.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<h2>示例</h2>\n<p>在 <code>application.properties</code> 中配置 Nacos Server 的地址：</p>\n<pre><code>nacos.config.server-addr=127.0.0.1:8848\n</code></pre>\n<p><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\">使用 </span></span><code>@NacosPropertySource</code><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\"> 加载 </span></span><code>dataId</code><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\"> 为 </span></span><code>example</code><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\"> 的配置源，并开启自动更新：</span></span></p>\n<pre><code class=\"language-plain\">@SpringBootApplication\n@NacosPropertySource(dataId = &quot;example&quot;, autoRefreshed = true)\npublic class NacosConfigApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(NacosConfigApplication.class, args);\n    }\n}\n</code></pre>\n<p><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\">通过 Spring 的 </span></span><code>@Value</code><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\"> 注解设置属性值，注意，需要同时有 </span></span><code>Setter</code><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\">方法才能在配置变更的时候自动更新：</span></span></p>\n<pre><code>@Controller\n@RequestMapping(&quot;config&quot;)\npublic class ConfigController {\n\n    @Value(&quot;${useLocalCache:false}&quot;)\n    private boolean useLocalCache;\n\n    public void setUseLocalCache(boolean useLocalCache) {\n        this.useLocalCache = useLocalCache;\n    }\n\n    @RequestMapping(value = &quot;/get&quot;, method = GET)\n    @ResponseBody\n    public boolean get() {\n        return useLocalCache;\n    }\n}\n</code></pre>\n<h2>运行</h2>\n<p>启动 <code>NacosConfigApplication</code>，调用 <code>curl http://localhost:8080/config/get</code>，返回内容是 <code>false</code>。</p>\n<p>通过调用 <a href=\"https://nacos.io/zh-cn/docs/open-API.html\">Nacos Open API</a> 向 Nacos Server 发布配置：dataId 为<code>example</code>，内容为<code>useLocalCache=true</code></p>\n<pre><code>curl -X POST &quot;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=example&amp;group=DEFAULT_GROUP&amp;content=useLocalCache=true&quot;\n</code></pre>\n<p>再次访问 <code>http://localhost:8080/config/get</code>，此时返回内容为<code>true</code>，说明程序中的<code>useLocalCache</code>值已经被动态更新了。</p>\n<h1>服务发现</h1>\n<p><span data-type=\"color\" style=\"color:rgb(38, 38, 38)\"><span data-type=\"background\" style=\"background-color:rgb(255, 255, 255)\">完整示例代码：</span></span><a href=\"https://github.com/nacos-group/nacos-demo/nacos-spring-boot-discovery-demo\">nacos-spring-boot-discovery-example</a></p>\n<h2>依赖</h2>\n<pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;nacos-discovery-spring-boot-starter&lt;/artifactId&gt;\n    &lt;version&gt;${latest.version}&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>\n<h2>示例</h2>\n<p>在 <code>application.properties</code> 中配置 Nacos Server 的地址：</p>\n<pre><code>nacos.discovery.server-addr=127.0.0.1:8848\n</code></pre>\n<p>使用 <code>@NacosInjected</code> 注入  Nacos 的 <code>NamingService</code> 实例：</p>\n<pre><code>@Controller\n@RequestMapping(&quot;discovery&quot;)\npublic class DiscoveryController {\n\n    @NacosInjected\n    private NamingService namingService;\n\n    @RequestMapping(value = &quot;/get&quot;, method = GET)\n    @ResponseBody\n    public List&lt;Instance&gt; get(@RequestParam String serviceName) throws NacosException {\n        return namingService.getAllInstances(serviceName);\n    }\n}\n\n@SpringBootApplication\npublic class NacosDiscoveryApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(NacosDiscoveryApplication.class, args);\n    }\n}\n</code></pre>\n<h2>运行</h2>\n<p>启动 <code>NacosDiscoveryApplication</code>，调用 <code>curl http://localhost:8080/discovery/get?serviceName=example</code>，此时返回为空 JSON 数组<code>[]</code>。</p>\n<p>通过调用 <a href=\"https://nacos.io/zh-cn/docs/open-API.html\">Nacos Open API</a> 向  Nacos Server 注册一个名称为 <code>example</code> 服务</p>\n<pre><code>curl -X PUT 'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=example&amp;ip=127.0.0.1&amp;port=8080'\n</code></pre>\n<p>再次访问 <code>curl http://localhost:8080/discovery/get?serviceName=example</code>，此时返回内容为：</p>\n<pre><code>[\n  {\n    &quot;instanceId&quot;: &quot;127.0.0.1-8080-DEFAULT-example&quot;,\n    &quot;ip&quot;: &quot;127.0.0.1&quot;,\n    &quot;port&quot;: 8080,\n    &quot;weight&quot;: 1.0,\n    &quot;healthy&quot;: true,\n    &quot;cluster&quot;: {\n      &quot;serviceName&quot;: null,\n      &quot;name&quot;: &quot;&quot;,\n      &quot;healthChecker&quot;: {\n        &quot;type&quot;: &quot;TCP&quot;\n      },\n      &quot;defaultPort&quot;: 80,\n      &quot;defaultCheckPort&quot;: 80,\n      &quot;useIPPort4Check&quot;: true,\n      &quot;metadata&quot;: {}\n    },\n    &quot;service&quot;: null,\n    &quot;metadata&quot;: {}\n  }\n]\n</code></pre>\n<h1>参看</h1>\n<ul>\n<li><a href=\"https://github.com/alibaba/nacos\">Nacos</a></li>\n<li><a href=\"https://github.com/nacos-group/nacos-spring-project\">Nacos Spring</a></li>\n<li><a href=\"https://github.com/nacos-group/nacos-spring-boot-project\">Nacos Spring Boot</a></li>\n<li><a href=\"https://github.com/spring-cloud-incubator/spring-cloud-alibaba\">Spring Cloud</a> <a href=\"https://github.com/spring-cloud-incubator/spring-cloud-alibaba\">Alibaba</a></li>\n</ul>\n"
}